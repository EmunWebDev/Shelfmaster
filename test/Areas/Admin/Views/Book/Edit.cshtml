@model test.Areas.Admin.Models.BookViewModel

@{
    ViewData["Title"] = "Edit Book Details";
    ViewData["Navigation Title"] = "Edit Book Details";
}

<div class="row mt-5 g-3">

    <div class="col-12">
        <div class="card border-0 shadow-sm h-100 overflow-auto">
            <div class="card-body">

                    <div class="row">
                        <div class="col">
                            <nav class="d-flex justify-content-between align-items-center w-100" style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                                <ol class="breadcrumb text-color4 mb-0">
                                    <li class="breadcrumb-item"><a asp-controller="Book" asp-action="Index" class="text-color3 fw-bold">Books</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Edit Book Details</li>
                                </ol>

                                <button class="btn d-flex align-items-center ms-auto bg-color2 py-0 mb-3" id="toggleEditBtn" onclick="toggleEditMode()" data-editing="false">
                                    <i class="ri-toggle-line fs-5 me-1"></i> <span>Edit</span>
                                </button>

                            </nav>
                        </div>
                    </div>

                    <hr />
                <form asp-controller="Book" asp-action="Update" method="post" enctype="multipart/form-data">
                    <div class="row">
                        <input type="hidden" asp-for="Id" />
                        <!--Book-->
                        <div class="col-12 col-sm-3 col-md-3 col-lg-2">
                            <span class="fw-bold">Book</span>
                        </div>
                        <div class="col-12 col-sm-9 col-md-9 col-lg-10">
                            <div class="row">
                                <div class="col">
                                    <label>Title</label>
                                    <input asp-for="Title" type="text" class="form-control" aria-label="Title" value="@Model.Title" disabled>
                                </div>
                                <div class="col">
                                    <label>Description</label>
                                    <textarea asp-for="Description" type="text" rows="1" class="form-control" aria-label="Description" disabled>@Model.Description</textarea>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col">
                                    <label>ISBN</label>
                                    <input asp-for="ISBN" type="text" class="form-control" aria-label="ISBN" value="@Model.ISBN" disabled>
                                </div>
                                <div class="col">
                                    <label>Publication Year</label>
                                    <input asp-for="PublicationYear" type="number" class="form-control" aria-label="Year Published"
                                           min="1900" max="2099" step="1" value="@Model.PublicationYear" disabled>
                                </div>
                            </div>

                            <div class="mt-3">
                                <label>Genre</label>
                                <select asp-for="SelectedGenreId" class="form-select" disabled>
                                    <option value="" selected disabled>Select Genre</option>
                                    @foreach (var genre in Model.Genres)
                                    {
                                        <option value="@genre.Id" selected="@(genre.Id == Model.Id ? "selected" : null)">@genre.Name</option>
                                    }
                                </select>
                            </div>
                            <div class="mt-3">
                                <label class="form-label">Current Cover Image</label>
                                <div>
                                    @if (!string.IsNullOrEmpty(Model.CoverImageString))
                                    {
                                        <img src="~/@Model.CoverImageString" alt="Cover Image" class="img-thumbnail" style="max-width: 200px;" />
                                    }
                                    else
                                    {
                                        <p>No cover image available.</p>
                                    }
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="formFile" class="form-label">Upload New Cover Image</label>
                                <input asp-for="CoverImage" class="form-control" type="file" id="formFile" disabled>
                            </div>


                        </div>
                    </div>

                    <hr />

                    <!--Author-->
                    <div class="row mt-3">
                        <div class="col-12 col-sm-3 col-md-3 col-lg-2">
                            <span class="fw-bold">Author</span>
                        </div>
                        <div class="col-12 col-sm-9 col-md-9 col-lg-10">
                            <select asp-for="SelectedAuthorId" class="form-select" disabled>
                                <option value="" selected disabled>Select Author</option>
                                @foreach (var author in Model.Authors)
                                {
                                    <option value="@author.Id" selected="@(author.Id == Model.Id ? "selected" : null)">@author.Name</option>
                                }
                            </select>
                        </div>
                    </div>

                    <hr />

                    <!--Publisher-->
                    <div class="row mt-3">
                        <div class="col-12 col-sm-3 col-md-3 col-lg-2">
                            <span class="fw-bold">Publisher</span>
                        </div>
                        <div class="col-12 col-sm-9 col-md-9 col-lg-10">
                            <select asp-for="SelectedPublisherId" class="form-select" disabled>
                                <option value="" selected disabled>Select Publisher</option>
                                @foreach (var publisher in Model.Publishers)
                                {
                                    <option value="@publisher.Id" selected="@(publisher.Id == Model.Id ? "selected" : null)">@publisher.Name</option>
                                }
                            </select>
                        </div>
                    </div>

                    <hr />

                    <div class="row mt-3">
                        <div class="col-12 col-sm-3 col-md-3 col-lg-2">
                            <span class="fw-bold">Created At</span>
                        </div>
                        <div class="col-12 col-sm-9 col-md-9 col-lg-10">
                            <p>@Model.CreatedAt?.ToString("f")</p>                            
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12 col-sm-3 col-md-3 col-lg-2">
                            <span class="fw-bold">Updated At</span>
                        </div>
                        <div class="col-12 col-sm-9 col-md-9 col-lg-10">
                            <p>@Model.UpdatedAt?.ToString("f")</p>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12 col-sm-3 col-md-3 col-lg-2">
                        </div>
                        <div class="col-12 col-sm-9 col-md-9 col-lg-10">
                            <div class="d-flex align-items-center justify-content-start">
                                <a asp-controller="Book" asp-action="Index" class="btn bg-color1 me-2 px-3">Cancel</a>
                                <button type="submit" id="saveBtn" class="btn bg-color3 px-5" disabled>Save Changes</button>

                            </div>
                        </div>
                    </div>
                </form>

            </div>

        </div>
    </div>
</div>

<script>
    function toggleEditMode() {
        const editBtn = document.getElementById("toggleEditBtn");
        const editIcon = editBtn.querySelector("i");
        const editText = editBtn.querySelector("span");
        const inputs = document.querySelectorAll(".form-control, .form-select");
        const saveBtn = document.getElementById("saveBtn");

        const isEditing = editBtn.dataset.editing === "true";

        // Toggle form inputs between disabled and enabled
        inputs.forEach(input => {
            input.disabled = isEditing;  // Disable if already in edit mode, enable if not
        });

        // Toggle button text and icon based on mode
        if (isEditing) {
            editIcon.classList.replace("ri-toggle-fill", "ri-toggle-line");
            editText.textContent = "Edit";
            editBtn.classList.replace("bg-color3", "bg-color2");
            saveBtn.setAttribute("disabled", "true"); // Disable save when not editing
        } else {
            editIcon.classList.replace("ri-toggle-line", "ri-toggle-fill");
            editText.textContent = "Editing";
            editBtn.classList.replace("bg-color2", "bg-color3");
            saveBtn.removeAttribute("disabled"); // Enable save when in editing mode
        }

        // Update the state for toggling edit mode
        editBtn.dataset.editing = isEditing ? "false" : "true";
    }



</script>

